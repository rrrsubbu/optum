trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.x'

- task: Checkout@v2
  displayName: 'Checkout repository'

- task: Docker@2
  displayName: 'Login to Azure Container Registry'
  inputs:
    containerRegistry: '<your-acr-service-connection>'
    command: 'login'

- task: Docker@2
  displayName: 'Build and push Docker image'
  inputs:
    containerRegistry: '<your-acr-service-connection>'
    repository: '<your-acr-name>/flask-app'
    command: 'buildAndPush'
    Dockerfile: 'Dockerfile'
    tags: |
      $(Build.BuildId)

- task: AzureWebAppContainer@1
  displayName: 'Deploy Docker image to Azure Web App'
  inputs:
    azureSubscription: '<your-azure-subscription>'
    appName: 'flask-app-webapp'  # Replace with your Azure Web App name
    containers: |
      <your-acr-name>/flask-app:$(Build.BuildId)
